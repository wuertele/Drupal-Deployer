<?php
<<<<<<< user_register_notify.module
<<<<<<< user_register_notify.module
// $Id$
// Built for Drupal 6
=======
// $Id$
>>>>>>> 1.4
=======
// $Id:
// Built for Drupal 6
>>>>>>> 1.1.2.1.2.4

/**
 * @file
 * Notifies administrator of new user registrations.
 */

<<<<<<< user_register_notify.module
<<<<<<< user_register_notify.module
/**
 * Implementation of hook_help().
 */
function user_register_notify_help($path, $arg) {
  if ($path == 'admin/help#user_register_notify') {
    return '<p>'.
      t('This module provides a way for an administrator to get'.
      'an email when a user account is created. '.
      'It assumes that the Drupal mailer is configured.') .
      '</p>';
  }
}

define('USER_REGISTER_NOTIFY_SUBJECT', t('Account details for !user_name at !site'));
define('USER_REGISTER_NOTIFY_BODY', t("!user_name (!user_view) has created account.\n\nEdit user: !user_edit\n\nDelete User: !user_delete\n\n!profile"));
=======
>>>>>>> 1.4
=======
/**
 * Implementation of hook_help().
 */
function user_register_notify_help($path, $arg) {
  if ($path == 'admin/help#user_register_notify') {
    $txt = 'This module provides a way for an administrator to get'.
      'an email when a user account is created. '.
      'It assumes that the Drupal mailer is configured.';
    return '<p>'. t($txt) .'</p>';
  }
}

define('USER_REGISTER_NOTIFY_SUBJECT', t('Account details for !user_name at !site'));
define('USER_REGISTER_NOTIFY_BODY', t("!user_name (!user_view) has created account.\n\nEdit user: !user_edit\n\nDelete User: !user_delete\n\n!profile"));
>>>>>>> 1.1.2.1.2.4

/**
 * Implementation of hook_menu().
 */
<<<<<<< user_register_notify.module
<<<<<<< user_register_notify.module
function user_register_notify_menu() {
  $items['admin/settings/register_notify'] = array(
    'title' => 'User Register Notify',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('user_register_notify_settings'),
    'description' => 'Configure the User Register Notify module.',
    'file' => 'user_register_notify.admin.inc',
    'access arguments' => array('administer site configuration'),
  );
=======
function user_register_notify_menu($may_cache) {
  $items = array();
  if ($may_cache) {
    $items[] = array(
      'path' => 'admin/settings/register_notify',
      'title' => t('User Register Notify'),
      'callback' => 'drupal_get_form',
      'callback arguments' => array('user_register_notify_settings'),
      'description' => t('Configure the User Register Notify module.'),
      'access' => user_access('administer site configuration')
    );
  }
>>>>>>> 1.4
=======
function user_register_notify_menu() {
  $items['admin/settings/register_notify'] = array(
    'title' => 'User Register Notify',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('user_register_notify_settings'),
    'description' => 'Configure the User Register Notify module.',
    'access arguments' => array('administer site configuration'),
  );
>>>>>>> 1.1.2.1.2.4
  return $items;
}

<<<<<<< user_register_notify.module
=======

/**
 * Menu callback for admin settings form.
 */
function user_register_notify_settings() {
  $form['user_register_notify_mailto'] = array(
    '#type' => 'textfield',
    '#title' => t('Send notifications to this email address'),
    '#description' => t('If you leave this blank, the site email address, %mailto, will be used.', array('%mailto' => variable_get('site_mail', ini_get('sendmail_from')))),
    '#default_value' => variable_get('user_register_notify_mailto', variable_get('site_mail', ini_get('sendmail_from'))),
  );
  $form['user_register_notify_subject'] = array(
    '#type' => 'textfield',
    '#title' => t('Email Subject'),
    '#default_value' => variable_get('user_register_notify_subject', USER_REGISTER_NOTIFY_SUBJECT),
    '#required' => TRUE,
    '#description' => t('Subject of user registration messages')
  );
  $form['user_register_notify_body'] = array(
    '#type' => 'textarea',
    '#title' => t('Email Body'),
    '#default_value' => variable_get('user_register_notify_body', USER_REGISTER_NOTIFY_BODY),
    '#rows' => 10,
    '#required' => TRUE,
    '#description' => t('Customize the body of the user registration notification email.') .' '. t('Available variables are:') .' !user_name, !user_mail, !user_view, !user_edit, !user_delete, !site, !uri, !uri_brief, !date, !profile.'
  );
  return system_settings_form($form);
}

<<<<<<< user_register_notify.module

>>>>>>> 1.4
=======
>>>>>>> 1.1.2.1.2.4
/**
 * Implementation of hook_user().
 */
function user_register_notify_user($op, &$edit, &$account, $category = NULL) {
  switch ($op) {
    case 'insert':
      // Notify administrator of new user only if this is not first user and
      // if visitors can create accounts without administrator's approval.
      // In case when accounts must be created with administrator's approval
      // there is already a 'pending approval' e-mail notification.
      if ($account->uid != 1 && (variable_get('user_register', 1) == 1 ? $account->status : !$account->status)) {
        $from = variable_get('site_mail', ini_get('sendmail_from'));
        $to = variable_get('user_register_notify_mailto', $from);
        $params = array('account' => $account);

        drupal_mail(
          'user_register_notify',
          'user-register-notify-admin',
          $to,
          language_default(),
          $params,
          $from,
          true // Automatically send
        );
      }
      break;
  }
}
<<<<<<< user_register_notify.module
<<<<<<< user_register_notify.module

function user_register_notify_mail($key, &$message, $params) {

  if ($key == 'user-register-notify-admin') {
    $language = $message['language'];
    $langcode = $language->language;
    $uaccount = $params['account'];
    $account_data = "";
    if (module_exists('profile')) {
      $result = db_query('SELECT f.name, f.type, v.value FROM {profile_fields} f INNER JOIN {profile_values} v ON f.fid = v.fid WHERE uid = %d', $uaccount->uid);
      while ($field = db_fetch_object($result)) {
        switch ($field->type) {
          case 'date':
            $date_field = unserialize($field->value);
            if (is_array($date_field)) {
              $date_timestamp = mktime(0, 0, 0, $date_field['month'], $date_field['day'], $date_field['year']);
              $account_data .= sprintf("%s: %s\n", $field->name, format_date($date_timestamp));
            }
            break;
          case 'checkbox':
            if ($field->value)
              $account_data .= sprintf("%s: Checked\n", $field->name);
            else
              $account_data .= sprintf("%s: Not Checked\n", $field->name);
            break;
          default:
            $account_data .= sprintf("%s: %s\n", $field->name, $field->value);
        }
      }
    }
    $variables = array(
      '!user_name' => $uaccount->name,
      '!user_mail' => $uaccount->mail,
      '!user_view' => url('user/'. $uaccount->uid, array('absolute' => TRUE)),
      '!user_edit' => url('user/'. $uaccount->uid .'/edit', array('absolute' => TRUE)),
      '!user_delete' => url('user/'. $uaccount->uid .'/delete', array('absolute' => TRUE)),
      '!site' => variable_get('site_name', 'Drupal'),
      '!uri' => $base_url,
      '!uri_brief' => drupal_substr($base_url, drupal_strlen('http://')),
      '!date' => format_date(time()),
      '!profile' => check_plain($account_data),
    );
    $message['subject'] = t(variable_get('user_register_notify_subject', USER_REGISTER_NOTIFY_SUBJECT), $variables);
    $message['body'] = t(variable_get('user_register_notify_body', USER_REGISTER_NOTIFY_BODY), $variables);
  }
}

=======
>>>>>>> 1.4
=======

function user_register_notify_mail($key, &$message, $params) {

  if ($key == 'user-register-notify-admin') {
    $language = $message['language'];
    $langcode = $language->language;
    $uaccount = $params['account'];
    $account_data = "";
    if (module_exists('profile')) {
      $result = db_query('SELECT f.name, v.value FROM {profile_fields} f INNER JOIN {profile_values} v ON f.fid = v.fid WHERE uid = %d', $uaccount->uid);
      while ($field = db_fetch_object($result)) {
        $account_data .= sprintf("%s: %s\n", $field->name, $field->value);
      }
    }
    $variables = array(
      '!user_name' => $uaccount->name,
      '!user_mail' => $uaccount->mail,
      '!user_view' => url('user/'. $uaccount->uid, array('absolute' => TRUE)),
      '!user_edit' => url('user/'. $uaccount->uid .'/edit', array('absolute' => TRUE)),
      '!user_delete' => url('user/'. $uaccount->uid .'/delete', array('absolute' => TRUE)),
      '!site' => variable_get('site_name', 'Drupal'),
      '!uri' => $base_url,
      '!uri_brief' => substr($base_url, strlen('http://')),
      '!date' => format_date(time()),
      '!profile' => check_plain($account_data),
    );
    $message['subject'] = t(variable_get('user_register_notify_subject', USER_REGISTER_NOTIFY_SUBJECT), $variables);
    $message['body'] = t(variable_get('user_register_notify_body',USER_REGISTER_NOTIFY_BODY), $variables);
  }
}

>>>>>>> 1.1.2.1.2.4
